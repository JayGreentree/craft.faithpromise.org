{#
 # Homepage template
 # ---------------
 #
 # When this template gets loaded, it will be because someone has accessed
 # http://yoursite.com/ (without any URI). Craft checks to see if you have
 # a Single section set to be the Homepage (as you do, by default), and
 # loads the section’s Template (this file). A special ‘entry’ variable
 # will already be set for you, assigned to the Homepage entry.
 #
 # It's worth noting that even if you didn't have a Homepage Single section,
 # as long as this template remains at craft/templates/index.html, it
 # would still be the one to get loaded when accessing http://yoursite.com/,
 # albeit without an ‘entry’ variable already set for you.
 #
 # See this page for more details on how Craft routes requests:
 # http://craftcms.com/docs/routing
 #}

{#
|--------------------------------------------------------------------------
| Get global event
|--------------------------------------------------------------------------
#}

{% set nav_class = 'Nav--overlay' %}
{% set cache_key = 'home_page_' ~ (craft.request.isMobileBrowser() ? 'mobile' : 'desktop') %}

{% extends '_layout/layout.twig' %}

{% block content %}

    {% cache globally using key cache_key %}

    {% set global_event = craft.entries({ type: 'globalEvent' }).order('expiryDate').first() %}

    {% set latest_sermon = craft.entries({ type: 'sermon', with: 'series' }).order('sermonDate DESC').first() %}
    {% set latest_sermon_image = latest_sermon.series[0].seriesImageTall[0] %}
    {% set events_image = craft.entries.section('pages').slug('events').first().pageContent.type('header').first().image[0] %}

    {% if global_event %}

        <div id="Special" class="EventHero" style="background-image: url(/assets/temp.jpg)">
            <div class="EventHero-fadeup"></div>
            <div class="EventHero-container">
                <div class="EventHero-content">
                    <h2 class="EventHero-title">&quot;{{ global_event.title }}&quot;</h2>
                    <p class="EventHero-text">
                        {{ global_event.excerpt }}
                    </p>
                    <div class="EventHero-actions">
                        {% for action in global_event.actions %}
                            <a class="Button EventHero-action" href="{{ action.theUrl }}"><span class="u-hide-lt-480">{{ action.text }}</span><span class="u-hide-gte-480">{{ action.text }}</span></a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

    {% else %}

        <div class="HeaderVideo">
            {% if craft.request.isMobileBrowser() %}
                {# TODO: Get gif / mobile image #}
                <img src="https://placeimg.com/640/480/any/sepia?t=1505305979703">
            {% else %}
                {% set home_page_video = craft.assets.id(1580).first() %}
                <video autoplay loop muted preload>
                    {#<source src="http://elevationchurch.org/wp-content/uploads/2017/08/2017_Aug20_CuttingCorners_ECdotOrg_2.mp4" type="video/mp4">#}
                    <source src="{{ home_page_video.url }}" type="video/mp4">
                </video>
            {% endif %}
            <div class="HeaderVideo-overlay"></div>
            <div class="HeaderVideo-container">
                <div class="HeaderVideo-title">Real People. Real Problems. Real Love.</div>
                <div class="HeaderVideo-actions">
                    <a class="Button" href="/locations">Find a Location</a>
                    <a class="Button" href="http://online.faithpromise.org">Watch Online</a>
                </div>
            </div>

        </div>

    {% endif %}

    <div class="ImageCards">
        <div class="ImageCards-container">
            <ul class="ImageCards-list">
                <li class="ImageCards-row">
                    <a class="ImageCards-item" href="{{ latest_sermon.url }}">
                        <img
                                class="ImageCards-image"
                                src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
                                sizes="50vw"
                                srcset="
                                        {{ latest_sermon_image.url({ width: 1920 }) }} 1920w,
                                        {{ latest_sermon_image.url({ width: 1680 }) }} 1680w,
                                        {{ latest_sermon_image.url({ width: 1280 }) }} 1280w,
                                        {{ latest_sermon_image.url({ width: 800 }) }} 800w,
                                        {{ latest_sermon_image.url({ width: 480 }) }} 480w,
                                        {{ latest_sermon_image.url({ width: 320 }) }} 320w,
                                    ">
                        <span class="ImageCards-link" href="/">Latest Sermon</span>
                    </a>
                </li>
                <li class="ImageCards-row">
                    <a class="ImageCards-item" href="/events">
                        <img
                                class="ImageCards-image"
                                src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
                                sizes="50vw"
                                srcset="
                                        {{ events_image.url({ width: 1920 }) }} 1920w,
                                        {{ events_image.url({ width: 1680 }) }} 1680w,
                                        {{ events_image.url({ width: 1280 }) }} 1280w,
                                        {{ events_image.url({ width: 800 }) }} 800w,
                                        {{ events_image.url({ width: 480 }) }} 480w,
                                        {{ events_image.url({ width: 320 }) }} 320w,
                                    ">
                        <span class="ImageCards-link" href="/">News &amp; Events</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    {% endcache %}

    {#{{ entry.body }}#}

    {#<h2>Recent News</h2>#}
    {#<ul>#}
    {#{% for entry in craft.entries.section('news').limit(5).find() %}#}
    {#<li><a href="{{ entry.url }}">{{ entry.title }}</a></li>#}
    {#{% endfor %}#}
    {#</ul>#}

{% endblock %}